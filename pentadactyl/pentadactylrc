" vim: fdm=marker
" vim: foldlevel=0

set rtp="~/.pentadactyl"

map < <silent> :tabmove -1<CR>
map > <silent> :tabmove +1<CR>

map K <silent> :tabnext<CR>
map J <silent> :tabprev<CR>

" Allow defaults to work
map <C-l> <Pass>
map <C-k> <Pass>
map <C-t> <Pass>
map <C-w> <Pass>


js config.guioptions['D'] = ['Delicious Toolbar',['ybToolbar']];
set go+=TrB

command! lastpasslogin javascript LP.lpOpenLogin()
command! lp lastpasslogin

command! google open google
command! g google

command! pbadd open javascript:q=location.href;if(document.getSelection){d=document.getSelection();}else{d='';};p=document.title;void(open('https://pinboard.in/add?url='+encodeURIComponent(q)+'&description='+encodeURIComponent(d)+'&title='+encodeURIComponent(p),'Pinboard',%20'toolbar=no,width=700,height=350'));
command! pbadds open javascript:if(document.getSelection){s=document.getSelection();}else{s='';};document.location='https://pinboard.in/add?next=same&url='+encodeURIComponent(location.href)+'&description='+encodeURIComponent(s)+'&title='+encodeURIComponent(document.title);
command! pb open https://pinboard.in/u:rygwdn
command! later open javascript:q=location.href;p=document.title;void(t=open('https://pinboard.in/add?later=yes&noui=yes&jump=close&url='+encodeURIComponent(q)+'&title='+encodeURIComponent(p),'Pinboard','toolbar=no,width=100,height=100'));t.blur();
command! unread open https://pinboard.in/oldest/

command! clip evernote
command! ev evernote
command! evernote open javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title);}})();
map C :clip<CR>

command! delic open http://www.delicious.com/home
command! dadd open javascript:(function(){f='http://www.delicious.com/save?url='+encodeURIComponent(window.location.href)+'&title='+encodeURIComponent(document.title)+'&v=5&'+'&notes='+encodeURIComponent(document.getSelection());a=function(){window.open(f+'&jump=doclose','deliciousuiv5','location=yes,links=yes,scrollbars=yes,toolbar=yes,')};a();})();

command! sub subscribe
command! subscribe open javascript:var%20b=document.body;var%20GR________bookmarklet_domain='http://www.google.com';if(b&&!document.xmlVersion){void(z=document.createElement('script'));void(z.src='http://www.google.com/reader/ui/subscribe-bookmarklet.js');void(b.appendChild(z));}else{location='http://www.google.com/reader/view/feed/'+encodeURIComponent(location.href)}

command! ril open javascript:(function(){ISRIL_H='06c5';ISRIL_SCRIPT=document.createElement('SCRIPT');ISRIL_SCRIPT.type='text/javascript';ISRIL_SCRIPT.src='http://readitlaterlist.com/b/r.js';document.getElementsByTagName('head')[0].appendChild(ISRIL_SCRIPT)})();
command! rild rildone
command! rildone open javascript:try%20{window.open('https://readitlaterlist.com/bl?r=1&u='+encodeURIComponent(document.location.href)+'&h=06c5','ril','toolbar=0,resizable=0,status=1,width=225,height=140');}catch(e)%20{%20}void(0);
command! rill rillist
command! rillist open javascript:try%20{window.open('http://readitlaterlist.com/unread?bl=1','rillist','scrollbars=1,toolbar=0,status=1,width=380,height=400');}catch(e)%20{%20}void(0);

map S :dadd<CR>
map D :pbadd<CR>
map U :unread<CR>
map <C-S-l> :later<CR>
map <C-S-s> :stumble<CR>
map <C-Up> :thumbup<CR>
map <C-Down> :thumbdown<CR>

set visualbell

loadplugins

"backup
"js <<EOF
"
"function saveEm(event) {
"    var browser = gBrowser.getBrowserForTab(event.target);
"    plugins.penbackup.saveaddons("~/archives/firefox-addons.bak");
"    plugins.penbackup.savetabs("~/archives/firefox-tabs.bak");
"};
"
"var c = gBrowser.tabContainer;
"c.addEventListener("TabOpen", saveEm, false);
"c.addEventListener("TabMove", saveEm, false);
"c.addEventListener("TabClose", saveEm, false);
"
"EOF
"endbackup
"
"set tabclose=left,opener,previous,right
"set tabopen=external:end,link:right,orphan:right
"set fbw+=alpha.glitch.com
"set fbw+=rdio.com
set fbw+=rim.net

command! gonew -nargs=1 js var args=<q-args>.split(","); var search = args[0].replace('"', "", 'g'); var open = args[1]; var matches = completion.runCompleter("buffer", search); if (matches.length > 0) { tabs.select(matches[0].id - 1, false); } else { dactyl.execute("tabopen " + open); }

map <silent> <A-p> :flashtoggle<CR>

set passkeys+='.*\.google\.com/reader/.*':jkyr<Space><S-Space>

set passkeys+='.*gerrit\..*':/NP[]jkflnpucorsO,gf,ga,gd,gi,gm,go,gs,gw,<Ctrl-s>
group gerrit -locations='.*gerrit.*\.'
map ? <Pass>
map <Esc> -b <Esc> <Esc><Pass>
group user

" Gmail stuff
set strictfocus+=mail.google.com:laissez-faire
"autocmd LocationChange !'mail\.google\.com' :set editor="gvim -f"
"autocmd LocationChange 'mail\.google\.com'  :set editor="gvim -f -c 'set ft=mail'"

"set passkeys+=mail.google.com:xsem!#rRaAvN[]{}z.IU=-gidac/?lujkonp<Esc>`y
set passkeys+=mail.google.com:ujkov<Esc>pn`c/qxsyem!#rRaAfFN[]{}z.IULhT_l,gi,gs,gt,gd,ga,gc,gb,gk,gl,gp,*a,*n,*r,*u,*s,*t,<Ctrl-s>
command! gm gonew gmail,https://mail.google.com/mail/?shva=1#inbox
map ,m :gm<CR>
group gmail -locations=mail.google.com
map ? <Pass>
map <Esc> -b <Esc> <Esc><Pass>
group user
" end gmail stuff

" TODO: (1) move work stuff to different file
" TODO: (2) make my own shortcuts for OWA
" TODO: (3) clean up this file
set passkeys+=cas-hq.rim.net:<Up><Down><Left><Right><Ctrl-n><Ctrl-s>

map ,t :gonew toodledo,td<CR>
map ,c :gonew "google calendar",gc<CR>
map ,r :gonew "google reader",gr<CR>
map ,d :gonew reddit,rd<CR>
map ,o :gonew outlook,https://cas-hq.rim.net/owa/<CR>
map ,g :gonew gerrit,http://gerrit.rim.net<CR>

map <C-/> <C-^>
map ^ <C-^>

map * -js hints.show("b", {continue: true, count:0})
map -modes hints * <Esc>

"set passunknown=embed,insert,normal

js <<EOF
plugins.pluginDl = {
    downloadPlugin: function(pluginName) {
        let url = "http://dactyl.sourceforge.net/plugins/" + pluginName + ".js";
        //let filename = url.split(/\/+/g).pop();
        let filename = pluginName + ".js"

        var f = io.File("~/.pentadactyl/plugins/" + filename);

        if(!f.exists()) 
            f.create(0x00,0644);

        var persist = Cc['@mozilla.org/embedding/browser/nsWebBrowserPersist;1'].createInstance(Ci.nsIWebBrowserPersist);
        const nsIWBP = Components.interfaces.nsIWebBrowserPersist;
        const flags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES;
        persist.persistFlags = flags | nsIWBP.PERSIST_FLAGS_FROM_CACHE;
        persist.saveURI(makeURI(url), null, null, null, null, f);
    }
};

EOF

"command! gonew -nargs=1 js var args=<q-args>.split(","); var search = args[0].replace('"', "", 'g'); var open = args[1]; var matches = completion.runCompleter("buffer", search); if (matches.length > 0) { tabs.select(matches[0].id - 1, false); } else { dactyl.execute("tabopen " + open); }
command downloadPlugin -nargs=1 js plugins.pluginDl.downloadPlugin(<q-args>)

command updatePlugins
\ downloadPlugin browser-improvements-dev
\ downloadPlugin curl-dev
\ downloadPlugin flashblock-dev
\ downloadPlugin http-headers-dev
\ downloadPlugin jscompletion-dev
\ downloadPlugin useragent-dev
\ rehash

"command! updatePlugin -nargs=1 
"
"command updatePlugins
"\ stuff here

" TODO: make this handle wikitext on wikis.rim.net
"autocmd LocationChange !mail.google.com,* :set editor&
"autocmd LocationChange mail.google.com :set editor=gvim -f -c 'set ft=mail' +<line>

command addbmarks
\ bmark -title=Acorn             -keyword=ac   http://acorn.acadiau.ca/my/
\ bmark -title="Search Google"   -keyword=g    http://www.google.ca/search?q=%s
\ bmark -title="Search PyPI"     -keyword=pypi http://pypi.python.org/pypi?%3Aaction=search&term=%s
\ bmark -title="Search PPA"      -keyword=ppa  https://launchpad.net/ubuntu/+ppas?name_filter=%s
\ bmark -title="Gmail"           -keyword=gm   https://mail.google.com/mail/?shva=1#inbox
\ bmark -title="Google Calendar" -keyword=gc   https://www.google.com/calendar/render?gsessionid=tytkp42YyR2FoRo4F9zAGQ
\ bmark -title="Google Reader"   -keyword=gr   http://www.google.com/reader/view/
\ bmark -title="reddit"          -keyword=rd   http://www.reddit.com/
\ bmark -title="Toodledo"        -keyword=td   http://www.toodledo.com/
\ bmark -title="Java6 API"       -keyword=j6   http://download.oracle.com/javase/6/docs/api/
\ bmark -title="Facebook"        -keyword=fb   https://facebook.com
